<!doctype html>
<html>

<head>
    <link rel="stylesheet" href="xterm.css" />
    <link rel='shortcut icon' type='image/x-icon' href='favicon-32x32.png' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"
        integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ=="
        crossorigin="anonymous"></script>
    <script src="xterm.js"></script>
    <title>Star Trek - Time Loop</title>
</head>

<body>
    <button onclick="window.location.reload()">PLAY GAME</button>
    <button id="myBtn">HOW TO PLAY</button>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <span id="modalHeading">How to play.</span><br>
            <div id="modal-text">
                1. If there is nothing currently in the black terminal box, click on "Play Game"<br><br>
                2. Click within the black terminal box that says "Star Trek Time Loop"<br><br>
                3. Enter your name when prompted (Surnames usually work better during gameplay!) and press enter to
                continue.<br><br>
                4. When asked if you want to skip introduction - type yes or no and press enter (it is recommended for
                first time players to go through the introduction as this gives important gameplay information.)<br><br>
                5. When prompted, type which path/room rumber you wish to take (1, 2, 3 or 4 depending on the amount of
                options.)<br><br>
                6. To be able to safely beam off the ship you must find: The Comms Device, The Location
                Device, the key for the Transporter device, and batteries for the Comms and Location devices. If you try
                to beam off the ship without having all of these items - you will die.<br><br>
                7. There are 3 automatic kill rooms, if you die your game progress will be reset and you must re-find
                any items you have aquired.<br><br>
                8. You can also gain and lose health depending on which rooms you visit. If your health reaches 0 or
                less, you will die and the game will end.<br><br>
                9.<strong>For those that want to cheat:</strong><br>You can view an example solution to the game <a
                    href="https://github.com/DeannaCarina/StarTrekTimeLoop/blob/main/assets/images/readme-images/solution.png"
                    target_blank>HERE</a>
            </div>
        </div>
    </div>
    <div id="terminal"></div>
    <div id="copy">
        &copy; DeannaCarina
    </div>
    <br>
    <span id="fancy">Fancy some background music?</span><br>
    <audio controls>
        <source src="music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>






    <script src="modal.js"></script>
    <script>
        var socket = null;
        var term = null;
        var buffer = '';

        function init_socket() {
            socket = io(window.location.protocol + '//' + window.location.host, {
                path: '/socket.io'
            });

            socket.on('connect', function () {
                socket.emit('connection_establish', 'ok');
                console.log("connected")
            });

            socket.on('console_output', function (msg, cb) {
                console.log("output:", msg)
                term.writeln(msg);
                term_short_prompt(term);
                if (cb)
                    cb();
            });

        }

        function term_prompt(term) {
            buffer = '';
            term.write('\r\n$ ');
        }

        function term_short_prompt(term) {
            buffer = '';
            term.write('\r$ ');
        }

        function init_terminal() {
            term = new window.Terminal();
            term.open(document.getElementById('terminal'));

            function runFakeTerminal() {
                if (term._initialized) {
                    return;
                }

                term._initialized = true;

                term.writeln('Running your file: run.py');
                term.writeln('');
                term_prompt(term);

                term.onData(e => {
                    switch (e) {
                        case '\r': // Enter
                            console.log("command entered: ", buffer)
                            socket.emit('command_entered', buffer);
                            term_prompt(term);
                            break;
                        case '\u007F': // Backspace (DEL)
                            // Do not delete the prompt
                            if (term._core.buffer.x > 2) {
                                term.write('\b \b');
                                buffer = buffer.slice(0, buffer.length - 1);
                            }
                            break;
                        default: // Print all other characters for demo
                            buffer = buffer + e;
                            term.write(e);
                    }
                });
            }

            runFakeTerminal();
        }

        document.addEventListener("DOMContentLoaded", function () {
            init_socket();
            init_terminal();
        });
    </script>

</body>

</html>