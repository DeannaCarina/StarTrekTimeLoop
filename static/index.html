<!doctype html>
<html>

<head>
    <link rel="stylesheet" href="xterm.css" />
    <link rel='shortcut icon' type='image/x-icon' href='favicon-32x32.png' />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.4/socket.io.js"
        integrity="sha512-aMGMvNYu8Ue4G+fHa359jcPb1u+ytAF+P2SCb+PxrjCdO3n3ZTxJ30zuH39rimUggmTwmh2u7wvQsDTHESnmfQ=="
        crossorigin="anonymous"></script>
    <script src="xterm.js"></script>
    <title>Star Trek - Time Loop</title>
</head>

<body>
    <button onclick="window.location.reload()">PLAY GAME</button>
    <button id="myBtn">HOW TO PLAY</button>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <span id="modalHeading">How to play.</span>
            <ol id="instructionList">
                <li>Choose the Harry Potter book from the main page that you want to be quizzed on.</li><br>
                <li>Select your answers on the quiz page that you think are correct, there are 20 questions per quiz.
                </li><br>
                <li>Once you have selected your answers, click on 'get results' to reveal your score and show which
                    answers you answered correctly or incorrectly.</li><br>
                <li>If you want to see the correct answers to the questions then click on 'reveal answers'.</li><br>
                <li>You have the option to come back to the main page using the home button or to try again using the
                    'retry' button</li><br>
                <li>See how you do on the quiz and challenge your friends to see who's the biggest Potter nerd!</li>
            </ol>
        </div>
    </div>
    <div id="terminal"></div>
    <script src="modal.js"></script>
    <script>
        var socket = null;
        var term = null;
        var buffer = '';

        function init_socket() {
            socket = io(window.location.protocol + '//' + window.location.host, {
                path: '/socket.io'
            });

            socket.on('connect', function () {
                socket.emit('connection_establish', 'ok');
                console.log("connected")
            });

            socket.on('console_output', function (msg, cb) {
                console.log("output:", msg)
                term.writeln(msg);
                term_short_prompt(term);
                if (cb)
                    cb();
            });

        }

        function term_prompt(term) {
            buffer = '';
            term.write('\r\n$ ');
        }

        function term_short_prompt(term) {
            buffer = '';
            term.write('\r$ ');
        }

        function init_terminal() {
            term = new window.Terminal();
            term.open(document.getElementById('terminal'));

            function runFakeTerminal() {
                if (term._initialized) {
                    return;
                }

                term._initialized = true;

                term.writeln('Running your file: run.py');
                term.writeln('');
                term_prompt(term);

                term.onData(e => {
                    switch (e) {
                        case '\r': // Enter
                            console.log("command entered: ", buffer)
                            socket.emit('command_entered', buffer);
                            term_prompt(term);
                            break;
                        case '\u007F': // Backspace (DEL)
                            // Do not delete the prompt
                            if (term._core.buffer.x > 2) {
                                term.write('\b \b');
                                buffer = buffer.slice(0, buffer.length - 1);
                            }
                            break;
                        default: // Print all other characters for demo
                            buffer = buffer + e;
                            term.write(e);
                    }
                });
            }

            runFakeTerminal();
        }

        document.addEventListener("DOMContentLoaded", function () {
            init_socket();
            init_terminal();
        });
    </script>

</body>

</html>